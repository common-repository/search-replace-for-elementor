var ELEMSNR=ELEMSNR||{};ELEMSNR.pluginUrl=elemsnr.plugin_url,ELEMSNR.pluginDomain=elemsnr.plugin_domain,ELEMSNR.ajaxUrl=elemsnr.ajax_url,ELEMSNR.ajaxNonce=elemsnr.ajax_nonce,ELEMSNR.highlightColor="#dc00af",ELEMSNR.ajaxRequest=function(n,r,s,t=!1){var e=new URL(document.location.href),l=r.find('input[name="elemsnr-search-phrase"]').val(),i=r.find('input[name="elemsnr-replace-with-phrase"]').val();t&&("elemsnr_highlight_search"===n?l=r.find("strong#elemsnr-undo-replace-with-phrase").text():(l=r.find("strong#elemsnr-undo-replace-with-phrase").text(),i=r.find("strong#elemsnr-undo-search-phrase").text())),jQuery.ajax({method:"post",url:ELEMSNR.ajaxUrl,data:{action:n,_wpnonce:ELEMSNR.ajaxNonce,current_post_id:e.searchParams.get("post"),search_phrase:l,replace_with_phrase:i,...s},beforeSend:function(){r.find(".elemsnr-loading-bar").show()},success:function(e){e&&!1===e.success||(e=JSON.parse(e)[0],"elemsnr_highlight_search"!==n&&r.find('input[name="elemsnr-search-phrase"], input[name="elemsnr-replace-with-phrase"]').val(""),t?"elemsnr_replace_search"===n?ELEMSNR.reloadElementorEditor(r,e.message):"elemsnr_highlight_search"===n&&ELEMSNR.ajaxRequest("elemsnr_replace_search",r,s,!0):1===e.status?ELEMSNR.reloadElementorEditor(r,e.message):jQuery("#elemsnr-output").addClass("elemsnr-output-active").empty().html(e.message))},complete:function(){r.find(".elemsnr-loading-bar").hide()},error:function(){jQuery("#elemsnr-output").addClass("elemsnr-output-active").empty().html("<strong>Internal Server Error!</strong><br />Contact your hosting provider and access your logs to learn more about what is causing the error.")}})},ELEMSNR.highlightTerms=function(e,n=!1){e.preventDefault();var e=jQuery(e.target).closest(".elemsnr-modal"),r={is_highlighted:e.find('input[name="elemsnr-highlight"]:checked').length,is_text_only:e.find('input[id="elemsnr-text-only"]:checked').length,is_case_sensitive:e.find('input[name="elemsnr-case-sensitive"]:checked').length,is_links:e.find('input[id="elemsnr-links"]:checked').length,is_images:e.find('input[id="elemsnr-images"]:checked').length};ELEMSNR.ajaxRequest("elemsnr_highlight_search",e,r,n)},ELEMSNR.unHighlightTerms=function(e){e.preventDefault();var e=jQuery(e.target).closest(".elemsnr-modal"),n={is_highlighted:e.find('input[name="elemsnr-highlight"]:checked').length,is_text_only:e.find('input[id="elemsnr-text-only"]:checked').length,is_case_sensitive:e.find('input[name="elemsnr-case-sensitive"]:checked').length,is_links:e.find('input[id="elemsnr-links"]:checked').length,is_images:e.find('input[id="elemsnr-images"]:checked').length};ELEMSNR.ajaxRequest("elemsnr_unhighlight_search",e,n)},ELEMSNR.replaceTerms=function(e,n=!1){e.preventDefault();var e=jQuery(e.target).closest(".elemsnr-modal"),r={is_highlighted:e.find('input[name="elemsnr-highlight"]:checked').length,is_text_only:e.find('input[id="elemsnr-text-only"]:checked').length,is_case_sensitive:e.find('input[name="elemsnr-case-sensitive"]:checked').length,is_links:e.find('input[id="elemsnr-links"]:checked').length,is_images:e.find('input[id="elemsnr-images"]:checked').length};ELEMSNR.ajaxRequest("elemsnr_replace_search",e,r,n)},ELEMSNR.replaceHTMLRegEx=function(e){e.preventDefault();e=jQuery(e.target).closest(".elemsnr-modal");ELEMSNR.ajaxRequest("elemsnr_replace_html_regex",e,{})},ELEMSNR.addNavMenu=function(){var e,n;jQuery("#elementor-panel-page-menu").length&&(e=jQuery(".elementor-panel-menu-item-finder")).length&&(n=jQuery("<div>",{class:"elementor-panel-menu-item elementor-panel-menu-item-search-and-replace"}).html(`
				<div class="elementor-panel-menu-item-icon"><i class="eicon-search-results"></i></div>
				<div class="elementor-panel-menu-item-title">Search & Replace</div>
			`),e.after(n))},ELEMSNR.addNavMenuEditorTopBar=function(){var e,n,r;jQuery("#elementor-editor-wrapper-v2").length&&(e=jQuery(".MuiBox-root div:first-child div + div")).length&&(n=jQuery("<span/>").addClass("eui-box eui-tooltip MuiBox-root css-0"),r=jQuery("<button>",{class:"MuiButtonBase-root MuiToggleButton-root MuiToggleButton-sizeSmall MuiToggleButton-standard eui-toggle-button css-1eryoft elementor-panel-menu-item-search-and-replace",tabindex:"0",type:"button",value:"Search & Replace","aria-pressed":"false","aria-label":"Search & Replace"}).html('<i class="eicon-search-results eicon-search-results--editor-top-bar"></i>'),n.html(r),n.appendTo(e))},ELEMSNR.openModal=function(){function i(e,n,r,s,t,l){return jQuery("<input/>").attr({type:e,id:n,name:r,placeholder:s,autocomplete:t,checked:l})}function a(e,n){return jQuery("<label/>").prop("for",e).html(n)}function e(e,n,r,s,t){return n=i("checkbox",e,n,"",r,s),a(e,t).prepend(n.prop("outerHTML")).prop("outerHTML")}function n(e,n,r,s,t){return n=i("radio",e,n,"",r,s),a(e,t).prepend(n.prop("outerHTML")).prop("outerHTML")}function r(e,n,r,s,t){var l="eicon-"+("text"===e&&"elemsnr-search-phrase"===n?"search":"site-search"),l=jQuery("<i/>").addClass(l),e=i(e,n,r,s,t);return(r=a(n)).prepend(l),r.append(e.prop("outerHTML")).prop("outerHTML")}var s=jQuery("<div>").addClass("elemsnr-search-replace").prop("id","elemsnr-search-replace");s.html(`
		<div class="elemsnr-modal" id="elemsnr-modal">
			<div class="elemsnr-body">
				<div class="elemsnr-header">
					<div class="elemsnr-logo">
						<i class="eicon-search-results"></i>
						<span class="elemsnr-title">Search & Replace</span>
					</div>
					<div class="elemsnr-icons">
						<i class="eicon-divider" aria-hidden="true"></i>
						<i class="eicon-help" aria-hidden="true"></i>
						<i class="eicon-close" aria-hidden="true"></i>
					</div>
					<div class="elemsnr-loading-bar"></div>
				</div>
				<div class="elemsnr-content">
					<div id="elemsnr-output"></div>
					<div class="elemsnr-row elemsnr-row-html-regexp">
						<div class="elemsnr-col" data-tooltip="Search and replace HTML in the Text Editor widget with regular expressions (experts only).">
							${e("elemsnr-html-regexp","elemsnr-html-regexp","off",!1,'HTML with RegEx (experts only) <i class="eicon-help" aria-hidden="true"></i>')}
						</div>
					</div>
					<div class="elemsnr-row elemsnr-row-options">
						<div class="elemsnr-col">
							${n("elemsnr-text-only","elemsnr-text-and-link","off",!0,"Text-only")}
							${n("elemsnr-links","elemsnr-text-and-link","off",!1,"Links (URLs)")}
							${n("elemsnr-images","elemsnr-text-and-link","off",!1,"Images")}
						</div>
						<div class="elemsnr-col">
							${e("elemsnr-highlight","elemsnr-highlight","off",!0,"Highlight text on search")}
							${e("elemsnr-case-sensitive","elemsnr-case-sensitive","off",!1,"Case-sensitive search and replace")}
						</div>
					</div>
					<div class="elemsnr-row">
						${r("text","elemsnr-search-phrase","elemsnr-search-phrase","Enter your search phrase (no HTML allowed)...","off")}
						<button type="submit" name="elemsnr-search-button" class="elemsnr-button">Search</button>
					</div>
					${r("text","elemsnr-replace-with-phrase","elemsnr-replace-with-phrase","Enter your replace with phrase (no HTML allowed)...","off")}
					<div class="elemsnr-button-group" data-tooltip="Perform a search before proceeding with the replacement action.">
						<button type="submit" name="elemsnr-replace-button" class="elemsnr-button" disabled>Replace</button>
						<button type="reset" name="elemsnr-clear-button" class="elemsnr-button">Clear</button>
					</div>
					<button type="submit" name="elemsnr-html-regexp-button" class="elemsnr-button">Search & Replace</button>
				</div>
			</div>
		</div>
	`),jQuery("#elemsnr-search-replace").remove(),jQuery("body").append(s),jQuery("#elemsnr-modal").draggable()},ELEMSNR.changeTextLink=function(e){function n(e,n,r,s){jQuery('input[name="elemsnr-search-phrase"]').attr({type:e,placeholder:n,readonly:r,class:s}),jQuery('input[name="elemsnr-replace-with-phrase"]').attr({type:e,placeholder:n,readonly:r,class:s})}function r(e,n){jQuery(e).toggle(n)}function s(e,n,r){jQuery('input[name="'+e+'"]').attr({disabled:n,checked:r})}e=jQuery(e.target);"elemsnr-text-only"===e.prop("id")&&(n("text","Enter your search phrase...",!1,""),r('label[for="elemsnr-highlight"], label[for="elemsnr-case-sensitive"]',!0),s("elemsnr-highlight",!1,!0),s("elemsnr-case-sensitive",!1,!0)),"elemsnr-links"===e.prop("id")&&(n("url","Enter your search URL...",!1,""),r('label[for="elemsnr-highlight"], label[for="elemsnr-case-sensitive"]',!1),s("elemsnr-highlight",!0,!1),s("elemsnr-case-sensitive",!0,!1)),"elemsnr-images"===e.prop("id")&&(n("url","Select your search image...",!0,"elemsnr-media-modal"),r('label[for="elemsnr-highlight"], label[for="elemsnr-case-sensitive"]',!1),s("elemsnr-highlight",!0,!1),s("elemsnr-case-sensitive",!0,!1))},ELEMSNR.closeModal=function(e){e.preventDefault(),jQuery("#elemsnr-search-replace").remove()},ELEMSNR.openMediaModal=function(e){var n,r=jQuery(e.target);jQuery('div[id^="__wp-uploader-id"]').remove(),(n=wp.media.frames.meta_image_frame=wp.media({title:"Search & Replace for Elementor (Images)",button:{text:"Select Image"}})).on("select",function(){var e=n.state().get("selection").first().toJSON();r.val(e.url)}),n.open()},ELEMSNR.highlightTermsOnLoad=function(){var e=jQuery(".elemsnr-modal");e.length&&(e.find('input[name="elemsnr-highlight"]:checked').length||e.find("#elemsnr-links:checked").length||e.find("#elemsnr-images:checked").length)&&(elementor.reloadPreview(),elementor.once("preview:loaded",function(){elementor.$preview.contents().find("head").append(jQuery("<style/>").prop("id","elemsnr").html(`elsnr-highlight { background-color: ${ELEMSNR.highlightColor}; padding: 3px; color: #242628; } .elsnr-highlight { outline: 3px solid ${ELEMSNR.highlightColor}; }`))}))},ELEMSNR.reloadElementorEditor=function(e,n){e={search_phrase:e.find('input[name="elemsnr-search-phrase"]').val(),replace_with_phrase:e.find('input[name="elemsnr-replace-with-phrase"]').val(),is_highlighted:e.find('input[name="elemsnr-highlight"]:checked').length,show_is_highlighted:e.find('label[for="elemsnr-highlight"]').css("display"),is_case_sensitive:e.find('input[name="elemsnr-case-sensitive"]:checked').length,show_is_case_sensitive:e.find('label[for="elemsnr-case-sensitive"]').css("display"),is_text_only:e.find('input[id="elemsnr-text-only"]:checked').length,is_links:e.find('input[id="elemsnr-links"]:checked').length,is_images:e.find('input[id="elemsnr-images"]:checked').length,response_message:n};sessionStorage.setItem("elemsnr",JSON.stringify(e)),window.location.reload(!0)},ELEMSNR.reloadSearchReplaceModal=function(){var e,n,r,s,t=JSON.parse(sessionStorage.getItem("elemsnr"));null!==t&&(ELEMSNR.openModal(),(e=jQuery(".elemsnr-modal")).length)&&(r={placeholder:"Enter your search URL...",readonly:!(n={placeholder:"Enter your search phrase...",readonly:!1,class:""}),class:""},s={placeholder:"Select your search image...",readonly:!0,class:"elemsnr-media-modal"},e.find('input[name="elemsnr-search-phrase"]').prop(n).val(t.search_phrase),e.find('input[name="elemsnr-replace-with-phrase"]').prop(n).val(t.replace_with_phrase),e.find('input[name="elemsnr-highlight"]').prop("checked",t.is_highlighted),e.find('input[id="elemsnr-text-only"]').prop("checked",t.is_text_only),e.find('input[name="elemsnr-case-sensitive"]').prop("checked",t.is_case_sensitive),e.find('input[id="elemsnr-links"]').prop("checked",t.is_links),e.find('input[id="elemsnr-images"]').prop("checked",t.is_images),t.search_phrase&&e.find('button[name="elemsnr-replace-button"]').prop("disabled",!1),t.is_links&&(e.find('input[name="elemsnr-search-phrase"]').prop(r),e.find('input[name="elemsnr-replace-with-phrase"]').prop(r)),t.is_images&&(e.find('input[name="elemsnr-search-phrase"]').prop(s),e.find('input[name="elemsnr-replace-with-phrase"]').prop(s)),e.find('label[for="elemsnr-highlight"]').css("display",t.show_is_highlighted),e.find('label[for="elemsnr-case-sensitive"]').css("display",t.show_is_case_sensitive),jQuery("#elemsnr-output").addClass("elemsnr-output-active").empty().html(t.response_message),(e.find('input[name="elemsnr-highlight"]:checked').length||e.find("#elemsnr-links:checked").length||e.find("#elemsnr-images:checked").length)&&(elementor.reloadPreview(),elementor.once("preview:loaded",function(){elementor.$preview.contents().find("head").append(jQuery("<style/>").prop("id","elemsnr").html(`elsnr-highlight { background-color: ${ELEMSNR.highlightColor}; padding: 3px; color: #242628; } .elsnr-highlight { outline: 3px solid ${ELEMSNR.highlightColor}; }`))})),sessionStorage.removeItem("elemsnr"))},ELEMSNR.toggleHTMLRegEx=function(e){var n=jQuery(e.target).closest(".elemsnr-modal"),r=n.find('input[name="elemsnr-search-phrase"]'),s=n.find('input[name="elemsnr-replace-with-phrase"]'),t=n.find(".elemsnr-row-options input"),l=n.find('.elemsnr-row-options label[for*="elemsnr-"]'),i=n.find('button[name="elemsnr-search-button"]'),a=n.find(".elemsnr-button-group"),o=n.find('button[name="elemsnr-html-regexp-button"]'),c=n.find("#elemsnr-output");jQuery(e.target).prop("checked")?(r.add(s).attr({type:"text",placeholder:"Enter your regular expression...",readonly:!1,class:""}),t.prop("disabled",!0),l.hide(),i.add(a).hide(),o.show(),c.addClass("elemsnr-output-active").html(`
      <strong>Important:</strong> It is strongly recommended to <strong>backup your database</strong> before you run the search and replace. Learn how to use regular expressions at <a href="https://regular-expressions.info/" target="_blank">Regular Expressions</a>.
    `)):(r.add(s).attr({type:"text",placeholder:"Enter your search phrase...(no HTML allowed)",readonly:!1,class:""}),t.prop("disabled",!1),n.find("input#elemsnr-text-only").prop("checked",!0),l.show(),i.add(a).show(),o.hide(),c.removeClass("elemsnr-output-active").empty())},ELEMSNR.toggleModalContent=function(e){e.preventDefault(),jQuery(e.target).closest(".elemsnr-modal").find(".elemsnr-content").slideToggle()},ELEMSNR.undoTerms=function(e){e.preventDefault(),ELEMSNR.highlightTerms(e,!0)},function(e){ELEMSNR.highlightTermsOnLoad(),ELEMSNR.reloadSearchReplaceModal(),setTimeout(function(){ELEMSNR.addNavMenuEditorTopBar()},500),e(document).on("click",'a[name="elemsnr-undo-button"]',ELEMSNR.undoTerms),e(document).on("click","i.eicon-close",ELEMSNR.closeModal),e(document).on("click","i.eicon-divider",ELEMSNR.toggleModalContent),e(document).on("click",".elementor-panel-menu-item-search-and-replace",ELEMSNR.openModal),e(document).on("click","#elementor-panel-header-menu-button",ELEMSNR.addNavMenu),e(document).on("click",'input[name="elemsnr-text-and-link"]',ELEMSNR.changeTextLink),e(document).on("click","input.elemsnr-media-modal",ELEMSNR.openMediaModal),e(document).on("click",'input[name="elemsnr-html-regexp"]',ELEMSNR.toggleHTMLRegEx),e(document).on("click",'button[name="elemsnr-search-button"]',ELEMSNR.highlightTerms),e(document).on("click",'button[name="elemsnr-clear-button"]',ELEMSNR.unHighlightTerms),e(document).on("click",'button[name="elemsnr-replace-button"]',ELEMSNR.replaceTerms),e(document).on("click",'button[name="elemsnr-html-regexp-button"]',ELEMSNR.replaceHTMLRegEx)}(jQuery);